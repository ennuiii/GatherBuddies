---
phase: 01-foundation
plan: 02
type: execute
---

<objective>
Create Phaser3 client with tilemap world rendering and avatar movement.

Purpose: Build the visual foundation - a 2D world where players can walk around as avatars.
Output: Working Phaser3 game that connects to Colyseus server and renders player avatars.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

**Reference Implementation:**
@SkyOffice/client/package.json
@SkyOffice/client/src/PhaserGame.ts
@SkyOffice/client/src/scenes/Game.ts
@SkyOffice/client/src/scenes/Bootstrap.ts
@SkyOffice/client/src/services/Network.ts
@SkyOffice/client/src/characters/MyPlayer.ts

**Established patterns:**
- Vite for build/dev
- React 18 with Redux Toolkit for UI layer
- Phaser3 for 2D game rendering
- Colyseus.js client for server connection
- Tilemap loaded from Tiled JSON

**Key decisions:**
- Simpler UI than SkyOffice - no MUI, use Tailwind CSS (matches GameBuddies convention)
- Copy SkyOffice's LimeZu assets (with attribution)
- Start with single preset avatar (adam) - customization is Phase 2+
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Phaser client project structure</name>
  <files>
    GameBuddiesHub/client/package.json,
    GameBuddiesHub/client/tsconfig.json,
    GameBuddiesHub/client/vite.config.ts,
    GameBuddiesHub/client/tailwind.config.js,
    GameBuddiesHub/client/postcss.config.js,
    GameBuddiesHub/client/index.html,
    GameBuddiesHub/client/src/main.tsx,
    GameBuddiesHub/client/src/App.tsx,
    GameBuddiesHub/client/src/index.css
  </files>
  <action>
Create client/ directory with Vite + React + Phaser setup.

package.json with:
- dependencies: react@^18, react-dom@^18, phaser@^3.55.2, colyseus.js@^0.14, @reduxjs/toolkit, react-redux
- devDependencies: vite@^5, @vitejs/plugin-react, typescript, tailwindcss, postcss, autoprefixer, @types/react, @types/react-dom

vite.config.ts:
- React plugin
- Server proxy /colyseus to localhost:2567
- Define VITE_SERVER_URL env variable

tailwind.config.js + postcss.config.js for Tailwind CSS setup.

index.html with div#root.

main.tsx: Render App component, import index.css.

App.tsx: Basic shell that will mount Phaser game.

index.css: Tailwind directives (@tailwind base/components/utilities).

DO NOT copy SkyOffice's SCSS/styled-components setup - use Tailwind.
  </action>
  <verify>
cd GameBuddiesHub/client && npm install && npm run dev
Vite dev server starts on port 5173
Browser shows basic React app
  </verify>
  <done>
Client directory created with working Vite + React setup.
npm run dev starts dev server.
Tailwind CSS configured and working.
  </done>
</task>

<task type="auto">
  <name>Task 2: Copy assets and create Phaser game bootstrap</name>
  <files>
    GameBuddiesHub/client/public/assets/ (copy from SkyOffice),
    GameBuddiesHub/client/src/PhaserGame.ts,
    GameBuddiesHub/client/src/scenes/Bootstrap.ts,
    GameBuddiesHub/client/src/scenes/Game.ts,
    GameBuddiesHub/client/src/anims/CharacterAnims.ts
  </files>
  <action>
Copy assets from SkyOffice/client/public/assets/ to GameBuddiesHub/client/public/assets/:
- tilemap.json (Tiled map)
- Character sprites (adam.png, etc.)
- Tileset images (tiles_wall.png, office.png, generic.png, basement.png)
- chairs.png, computers.png, whiteboards.png, vendingmachines.png

Create PhaserGame.ts:
- Export function to create Phaser.Game instance
- Config: WebGL renderer, 800x600, physics arcade, scale mode FIT
- Register scenes: Bootstrap, Game

Create Bootstrap.ts scene:
- Preload all assets (tilemap, tilesets, character sprites)
- On complete, start Game scene
- Reference SkyOffice/client/src/scenes/Bootstrap.ts for asset keys

Create Game.ts scene (simplified from SkyOffice):
- Load tilemap and create layers
- DO NOT include computers/whiteboards/vendingmachines item logic
- Set up camera and basic collisions
- Prepare for player creation (actual player comes in Task 3)

Create CharacterAnims.ts:
- Copy animation definitions from SkyOffice
- adam_idle_down, adam_run_down, etc.
  </action>
  <verify>
npm run dev
Browser console shows Phaser loading assets
No 404 errors for asset files
Phaser canvas renders (may be empty map initially)
  </verify>
  <done>
Assets copied and loadable.
Phaser game initializes with Bootstrap and Game scenes.
Tilemap renders in the browser.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement player avatar and Colyseus connection</name>
  <files>
    GameBuddiesHub/client/src/services/Network.ts,
    GameBuddiesHub/client/src/characters/MyPlayer.ts,
    GameBuddiesHub/client/src/characters/OtherPlayer.ts,
    GameBuddiesHub/client/src/scenes/Game.ts (update),
    GameBuddiesHub/client/src/stores/index.ts,
    GameBuddiesHub/client/src/stores/UserStore.ts,
    GameBuddiesHub/client/src/events/EventCenter.ts,
    GameBuddiesHub/client/src/App.tsx (update)
  </files>
  <action>
Create Network.ts service (simplified from SkyOffice):
- Colyseus Client connecting to ws://localhost:2567 (dev) or VITE_SERVER_URL (prod)
- Method joinHub() to join HUB room
- Set up state listeners: players.onAdd, players.onRemove, player.onChange
- Emit Phaser events on state changes
- Methods: updatePlayer(x, y, anim), updatePlayerName(name)

Create EventCenter.ts:
- Phaser Events for cross-system communication
- Events: PLAYER_JOINED, PLAYER_LEFT, PLAYER_UPDATED, MY_PLAYER_READY

Create Redux stores (simplified):
- stores/index.ts: Configure store
- stores/UserStore.ts: sessionId, playerName

Create MyPlayer.ts (Phaser game object):
- Extends Phaser.Physics.Arcade.Sprite
- WASD/Arrow key movement
- Update animation based on direction
- Send position updates to Network service
- Reference SkyOffice but simplify (no sitting behavior)

Create OtherPlayer.ts:
- Extends Phaser.Physics.Arcade.Sprite
- Interpolates to target position from server
- Updates animation from server state

Update Game.ts:
- Receive Network instance in create()
- Create MyPlayer sprite
- Listen for player join/leave events
- Manage otherPlayers group
- Camera follows MyPlayer

Update App.tsx:
- Create Network instance
- Create Phaser game, pass Network to Game scene
- Simple "Enter Hub" button to trigger connection
  </action>
  <verify>
1. Start server: cd GameBuddiesHub && npm run dev
2. Start client: cd GameBuddiesHub/client && npm run dev
3. Open browser to localhost:5173
4. Click enter button
5. Avatar appears and moves with WASD/arrows
6. Check Colyseus monitor - player shows in room
7. Open second browser tab - see other player avatar
  </verify>
  <done>
Player avatar renders and moves with keyboard input.
Position syncs to Colyseus server.
Other players appear when they join.
Two browser windows show each other's avatars.
Phase 1 Foundation complete.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` works in both server and client directories
- [ ] Avatar renders in Phaser canvas
- [ ] WASD/Arrow keys move avatar
- [ ] Movement syncs to server (visible in /colyseus monitor)
- [ ] Second browser tab shows other player's avatar
- [ ] No console errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Single player can walk around tilemap world
- Multiple players see each other's positions
- Foundation ready for Phase 2 (social features)
- Phase 1: Foundation complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`

Also update `.planning/ROADMAP.md`:
- Mark Phase 1 as complete
- Update progress table
</output>
