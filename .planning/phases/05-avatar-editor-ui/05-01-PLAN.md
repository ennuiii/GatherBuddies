---
phase: 05-avatar-editor-ui
plan: 01
type: execute
---

<objective>
Create a Phaser-based avatar editor scene for customizing avatars in-game.

Purpose: Allow players to customize their avatar appearance with body type, skin tone, hair, clothing, and accessories through a native Phaser UI that integrates seamlessly with the game.

Output: Working AvatarEditorScene that shows live preview, saves config, and transitions back to game with updated avatar.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-lpc-asset-integration/04-01-SUMMARY.md

**Key files from Phase 4:**
@GameBuddiesHub/client/src/services/AvatarManifest.ts
@GameBuddiesHub/client/src/services/AvatarCompositor.ts
@GameBuddiesHub/client/src/types/avatar.ts

**Scene structure:**
@GameBuddiesHub/client/src/game/scenes/Bootstrap.ts
@GameBuddiesHub/client/src/game/scenes/Game.ts
@GameBuddiesHub/client/src/game/scenes/index.ts

**Tech stack available:**
- AvatarManifest.getAvailableOptions() - all customization categories
- avatarCompositor.composeAvatar(config) - real-time texture composition
- avatarCompositor.createAnimations(textureKey) - animation setup

**Constraining decisions:**
- Phase 4: AvatarManifest as source of truth for all options
- Phase 4: Event-based character updates for live sync
- Milestone constraint: Keep editor in Phaser (not React modal)

**Existing React AvatarEditor:**
There is a React-based AvatarEditor.tsx component, but per milestone constraints, we need a Phaser-native implementation for better integration with the game canvas.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AvatarEditorScene with category tabs and option selection</name>
  <files>GameBuddiesHub/client/src/game/scenes/AvatarEditorScene.ts, GameBuddiesHub/client/src/game/scenes/index.ts</files>
  <action>
Create a new Phaser scene for avatar customization with:

1. Scene structure:
   - Background overlay (semi-transparent dark)
   - Main panel container (centered, ~600x500px)
   - Title "Customize Your Avatar"
   - Close/Cancel and Save buttons

2. Category tabs (left side or top):
   - Body (body type, skin tone)
   - Hair (style, color)
   - Clothing (top, bottom, shoes + colors for each)
   - Accessories (toggle on/off)

3. Option rendering:
   - Import from AvatarManifest.getAvailableOptions()
   - Text buttons for style options (body type, hair style, clothing items)
   - Color swatches for colors (use Phaser.GameObjects.Rectangle with fill)
   - Selected state visual indicator

4. State management:
   - Store current AvatarConfig being edited
   - Track active tab
   - Update config when options clicked

Use Phaser.GameObjects.Container for organization.
Use Phaser.GameObjects.Text for labels and buttons.
Use Phaser.GameObjects.Rectangle for panels and color swatches.

Do NOT use DOM elements or React - pure Phaser GameObjects only.
Do NOT over-engineer with complex UI framework - keep it simple.
  </action>
  <verify>Import and register scene in index.ts, verify it compiles without errors</verify>
  <done>AvatarEditorScene exists with tab navigation, options display, and state management</done>
</task>

<task type="auto">
  <name>Task 2: Add live avatar preview with real-time composition</name>
  <files>GameBuddiesHub/client/src/game/scenes/AvatarEditorScene.ts</files>
  <action>
Add live preview panel to the avatar editor:

1. Preview area (right side or top of panel):
   - Large preview sprite (scale 2x-3x for visibility)
   - Animate with idle animation (cycling through down/left/right/up)
   - Update immediately when any option changes

2. Preview update flow:
   - On any option change, call avatarCompositor.composeAvatar(config)
   - composeAvatar is async - show loading state briefly if needed
   - Once texture ready, update preview sprite with setTexture()
   - Create animations for new texture with createAnimations()

3. Debounce rapid changes:
   - If user clicks multiple options quickly, don't spam composition
   - Use a simple flag to skip if composition already in progress
   - Queue the latest config and apply when current completes

4. Initial state:
   - Load preview with current avatar config on scene start
   - Receive initial config via scene data: this.scene.start('avatarEditor', { config })

Do NOT block UI while composing - keep UI responsive.
Do NOT create new sprite each time - reuse and swap texture.
  </action>
  <verify>Change a hair style option, verify preview sprite updates within 1-2 seconds</verify>
  <done>Live preview shows composed avatar that updates in real-time when options change</done>
</task>

<task type="auto">
  <name>Task 3: Wire scene transitions and save callback</name>
  <files>GameBuddiesHub/client/src/game/scenes/AvatarEditorScene.ts, GameBuddiesHub/client/src/game/scenes/Game.ts</files>
  <action>
Connect the avatar editor to the game flow:

1. In Game.ts - Launch editor:
   - Add method openAvatarEditor() that pauses game and launches editor scene
   - Pass current avatar config: this.scene.launch('avatarEditor', { config: currentAvatarConfig, onSave: callback })
   - Add keyboard shortcut (e.g., 'E' key) to open editor when not in dialog
   - Disable player movement while editor is open

2. In AvatarEditorScene - Handle save:
   - On Save button click:
     a. Get final composed config
     b. Call onSave callback passed via scene data
     c. Stop editor scene to return to game
   - On Cancel/Close:
     a. Discard changes
     b. Stop editor scene

3. In Game.ts - Handle save callback:
   - Receive new config from editor
   - Call handleAvatarUpdated(newConfig) to update player texture
   - Resume player movement
   - Emit avatar update to server

4. Scene management:
   - Editor runs as overlay (scene.launch not scene.start)
   - Game scene stays active but paused/disabled
   - Editor scene is in front (higher depth)

Do NOT destroy game scene - just pause/resume.
Do NOT lose player position or state.
  </action>
  <verify>In running game, press E to open editor, make changes, save - verify player sprite updates with new avatar</verify>
  <done>Avatar editor opens from game, changes save back to player, game resumes correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] AvatarEditorScene registered in scenes/index.ts
- [ ] Editor opens with E key from game
- [ ] All customization categories accessible (body, hair, clothing, accessories)
- [ ] Live preview updates when changing options
- [ ] Save applies changes to player sprite
- [ ] Cancel returns without changes
- [ ] Game input disabled while editor open
- [ ] No TypeScript errors in the scene files
</verification>

<success_criteria>
- All tasks completed
- Avatar editor is fully Phaser-native (no DOM/React)
- Live preview works with real-time composition
- Scene transitions work cleanly (open/save/cancel)
- Player avatar updates correctly after saving
</success_criteria>

<output>
After completion, create `.planning/phases/05-avatar-editor-ui/05-01-SUMMARY.md`:

# Phase 5 Plan 01: Avatar Editor UI Summary

**[One-liner summary of what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [File list with descriptions]

## Decisions Made
- [Any decisions and rationale]

## Issues Encountered
- [Problems and resolutions]

## Next Step
Ready for Phase 6: First-Join & Persistence
</output>
