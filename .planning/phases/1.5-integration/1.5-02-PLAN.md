---
phase: 1.5-integration
plan: 02
type: execute
---

<objective>
Create Hub client using GameBuddiesTemplate structure.

Purpose: Follow standard GameBuddies client pattern for consistent UX.
Output: Hub client with HomePage, LobbyPage, GamePage (ready for Phaser).
</objective>

<context>
@.planning/PROJECT.md
@GameBuddiesTemplate/client/src/App.tsx
@GameBuddiesTemplate/client/src/pages/GamePage.tsx
@GameBuddiesTemplate/client/src/services/socketService.ts

**Architecture:**
- HomePage: Create/join hub room via Socket.IO
- LobbyPage: Standard lobby with video chat
- GamePage: Will contain Phaser canvas (next plan)

**Key pattern:**
GameBuddiesTemplate uses Socket.IO for room management.
Hub also needs Colyseus connection for 2D world (added in GamePage).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy GameBuddiesTemplate client structure</name>
  <files>
    GameBuddiesHub/client/ (overwrite with template structure)
  </files>
  <action>
Replace current GameBuddiesHub/client with GameBuddiesTemplate/client structure:

1. Backup current client (it has Phaser code we need later):
   - Copy src/scenes/, src/characters/, src/anims/ to temp location
   - Copy public/assets/ to temp location
2. Copy GameBuddiesTemplate/client/* to GameBuddiesHub/client/
3. Restore backed up directories (will integrate in next plan)

Keep these from current client:
- src/scenes/ (Bootstrap.ts, Game.ts)
- src/characters/ (Player.ts, MyPlayer.ts, OtherPlayer.ts)
- src/anims/ (CharacterAnims.ts)
- public/assets/ (tilemap, sprites)

Or better: Just copy template, then migrate Phaser files in next plan.
  </action>
  <verify>
GameBuddiesHub/client has template structure.
npm install works.
  </verify>
  <done>
Hub client has GameBuddiesTemplate structure.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure hub-specific metadata</name>
  <files>
    GameBuddiesHub/client/src/config/gameMeta.ts
  </files>
  <action>
Create or update gameMeta.ts for Hub:

```typescript
export const gameMeta = {
  id: 'hub',
  name: 'GameBuddies Hub',
  namespace: '/hub',
  version: '1.0.0',
  description: 'Virtual world lobby for GameBuddies',
};

// Server URLs
export const SOCKET_URL = import.meta.env.VITE_SOCKET_URL || 'http://localhost:3001';
export const COLYSEUS_URL = import.meta.env.VITE_COLYSEUS_URL || 'ws://localhost:3002';
```

This separates Socket.IO (room management) from Colyseus (world state).
  </action>
  <verify>
gameMeta.ts exports correct configuration.
URLs point to correct ports.
  </verify>
  <done>
Hub client configured with correct server URLs.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update socketService for hub namespace</name>
  <files>
    GameBuddiesHub/client/src/services/socketService.ts
  </files>
  <action>
Update socketService to use hub namespace:

1. Import gameMeta for namespace
2. Update connect() to use namespace: `io(SOCKET_URL + gameMeta.namespace)`
3. Keep all existing event handlers (room:create, room:join, etc.)

The Socket.IO connection handles:
- Room creation/joining (template flow)
- WebRTC signaling (video chat)
- Chat messages (lobby)

Colyseus connection (added in next plan) handles:
- Player positions
- Avatar animations
- 2D world state
  </action>
  <verify>
socketService connects to /hub namespace.
Room creation/joining works.
  </verify>
  <done>
Socket.IO service configured for hub namespace.
  </done>
</task>

<task type="auto">
  <name>Task 4: Add Colyseus client service</name>
  <files>
    GameBuddiesHub/client/src/services/colyseusService.ts
  </files>
  <action>
Create colyseusService for 2D world connection:

```typescript
import { Client, Room } from 'colyseus.js';
import { COLYSEUS_URL } from '../config/gameMeta';

class ColyseusService {
  private client: Client;
  private room: Room | null = null;

  constructor() {
    this.client = new Client(COLYSEUS_URL);
  }

  async joinHub(roomCode: string, playerName: string): Promise<Room> {
    this.room = await this.client.joinOrCreate('hub', {
      roomCode,
      playerName,
    });
    return this.room;
  }

  getRoom(): Room | null {
    return this.room;
  }

  leave(): void {
    this.room?.leave();
    this.room = null;
  }
}

export const colyseusService = new ColyseusService();
export default colyseusService;
```

This will be used by GamePage to sync 2D world state.
  </action>
  <verify>
colyseusService exports correctly.
TypeScript compiles.
  </verify>
  <done>
Colyseus client service ready for 2D world connection.
  </done>
</task>

<task type="auto">
  <name>Task 5: Add colyseus.js dependency</name>
  <files>
    GameBuddiesHub/client/package.json
  </files>
  <action>
Add colyseus.js client library:

```bash
cd GameBuddiesHub/client
npm install colyseus.js
```

This is the client-side library for connecting to Colyseus server.
  </action>
  <verify>
colyseus.js in dependencies.
npm install completes.
  </verify>
  <done>
Colyseus client library installed.
  </done>
</task>

<task type="auto">
  <name>Task 6: Verify template pages work</name>
  <files>
    (no changes - verification only)
  </files>
  <action>
Test that template structure works:

1. Start GameBuddieGamesServer (npm run dev)
2. Start Hub client (npm run dev in GameBuddiesHub/client)
3. Verify HomePage renders
4. Test room creation via Socket.IO
5. Verify LobbyPage shows after room creation
6. Verify GamePage renders (will show placeholder)

Note: Phaser integration is next plan. This verifies template structure works.
  </action>
  <verify>
Client starts without errors.
Can navigate HomePage → LobbyPage → GamePage.
Socket.IO connection works.
  </verify>
  <done>
Template-based Hub client verified working.
Ready for Phaser integration.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Hub client has GameBuddiesTemplate structure
- [ ] Socket.IO connects to /hub namespace on port 3001
- [ ] Colyseus service ready (not yet connected to Phaser)
- [ ] Can create/join rooms through HomePage
- [ ] LobbyPage shows with video chat controls
- [ ] GamePage renders placeholder
</verification>

<success_criteria>
- Hub client follows GameBuddiesTemplate patterns
- Room management works via Socket.IO
- Colyseus service ready for 2D world
- No breaking changes to template functionality
</success_criteria>

<output>
After completion, create `.planning/phases/1.5-integration/1.5-02-SUMMARY.md`
</output>
